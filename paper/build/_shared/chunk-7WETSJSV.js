import{J as C,N as M,W as V,a as O,b as v,c as w,d as E,e as T,f as P,g as A,h as y,j as L,l as N,m as R,n as p,o as x,p as D,q as U}from"/SequentialEGM/build/_shared/chunk-7WQZY7SB.js";import{b as F}from"/SequentialEGM/build/_shared/chunk-RAQ24GF6.js";function k(n){let t=Object.keys(n).join(""),e=/\w/.test(t);return e&&(t=t.replace(/\w/g,"")),`[${e?"\\w":""}${t.replace(/[^\w\s]/g,"\\$&")}]`}function q(n){let t=Object.create(null),e=Object.create(null);for(let{label:s}of n){t[s[0]]=!0;for(let o=1;o<s.length;o++)e[s[o]]=!0}let i=k(t)+k(e)+"*$";return[new RegExp("^"+i),new RegExp(i)]}function ye(n){let t=n.map(s=>typeof s=="string"?{label:s}:s),[e,i]=t.every(s=>/^\w+$/.test(s.label))?[/\w*$/,/\w+$/]:q(t);return s=>{let o=s.matchBefore(i);return o||s.explicit?{from:o?o.from:s.pos,options:t,validFor:e}:null}}function xe(n,t){return e=>{for(let i=C(e.state).resolveInner(e.pos,-1);i;i=i.parent){if(n.indexOf(i.name)>-1)return null;if(i.type.isTop)break}return t(e)}}function H(n,t){var e;let{source:i}=n,s=t&&i[0]!="^",o=i[i.length-1]!="$";return!s&&!o?n:new RegExp(`${s?"^":""}(?:${i})${o?"$":""}`,(e=n.flags)!==null&&e!==void 0?e:n.ignoreCase?"i":"")}function S(n,t){return w.create(n.filter(e=>e.field==t).map(e=>w.range(e.from,e.to)))}function G(n){let t=m.parse(n);return(e,i,s,o)=>{let{text:c,ranges:r}=t.instantiate(e.state,s),l={changes:{from:s,to:o,insert:O.of(c)},scrollIntoView:!0,annotations:i?K.of(i):void 0};if(r.length&&(l.selection=S(r,0)),r.length>1){let f=new h(r,0),a=l.effects=[b.of(f)];e.state.field(g,!1)===void 0&&a.push(y.appendConfig.of([g,te,ie,z]))}e.dispatch(e.state.update(l))}}function j(n){return({state:t,dispatch:e})=>{let i=t.field(g,!1);if(!i||n<0&&i.active==0)return!1;let s=i.active+n,o=n>0&&!i.ranges.some(c=>c.field==s+n);return e(t.update({selection:S(i.ranges,s),effects:b.of(o?null:new h(i.ranges,s)),scrollIntoView:!0})),!0}}function ve(n,t){return Object.assign(Object.assign({},t),{apply:G(n)})}var B,K,z,I,d,m,Q,X,h,b,Y,g,J,Z,_,ee,$,te,ie,W,we,ne=F(()=>{N();U();V();B=class{constructor(t,e,i){this.state=t,this.pos=e,this.explicit=i,this.abortListeners=[]}tokenBefore(t){let e=C(this.state).resolveInner(this.pos,-1);for(;e&&t.indexOf(e.name)<0;)e=e.parent;return e?{from:e.from,to:this.pos,text:this.state.sliceDoc(e.from,this.pos),type:e.type}:null}matchBefore(t){let e=this.state.doc.lineAt(this.pos),i=Math.max(e.from,this.pos-250),s=e.text.slice(i-e.from,this.pos-e.from),o=s.search(H(t,!1));return o<0?null:{from:i+o,to:this.pos,text:s.slice(o)}}get aborted(){return this.abortListeners==null}addEventListener(t,e){t=="abort"&&this.abortListeners&&this.abortListeners.push(e)}};K=A.define(),z=x.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"\xB7\xB7\xB7"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'\u0192'"}},".cm-completionIcon-class":{"&:after":{content:"'\u25CB'"}},".cm-completionIcon-interface":{"&:after":{content:"'\u25CC'"}},".cm-completionIcon-variable":{"&:after":{content:"'\u{1D465}'"}},".cm-completionIcon-constant":{"&:after":{content:"'\u{1D436}'"}},".cm-completionIcon-type":{"&:after":{content:"'\u{1D461}'"}},".cm-completionIcon-enum":{"&:after":{content:"'\u222A'"}},".cm-completionIcon-property":{"&:after":{content:"'\u25A1'"}},".cm-completionIcon-keyword":{"&:after":{content:"'\u{1F511}\uFE0E'"}},".cm-completionIcon-namespace":{"&:after":{content:"'\u25A2'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}}),I=class{constructor(t,e,i,s){this.field=t,this.line=e,this.from=i,this.to=s}},d=class{constructor(t,e,i){this.field=t,this.from=e,this.to=i}map(t){let e=t.mapPos(this.from,-1,v.TrackDel),i=t.mapPos(this.to,1,v.TrackDel);return e==null||i==null?null:new d(this.field,e,i)}},m=class{constructor(t,e){this.lines=t,this.fieldPositions=e}instantiate(t,e){let i=[],s=[e],o=t.doc.lineAt(e),c=/^\s*/.exec(o.text)[0];for(let l of this.lines){if(i.length){let f=c,a=/^\t*/.exec(l)[0].length;for(let u=0;u<a;u++)f+=t.facet(M);s.push(e+f.length-a),l=f+l.slice(a)}i.push(l),e+=l.length+1}let r=this.fieldPositions.map(l=>new d(l.field,s[l.line]+l.from,s[l.line]+l.to));return{text:i,ranges:r}}static parse(t){let e=[],i=[],s=[],o;for(let c of t.split(/\r\n?|\n/)){for(;o=/[#$]\{(?:(\d+)(?::([^}]*))?|([^}]*))\}/.exec(c);){let r=o[1]?+o[1]:null,l=o[2]||o[3]||"",f=-1;for(let a=0;a<e.length;a++)(r!=null?e[a].seq==r:l&&e[a].name==l)&&(f=a);if(f<0){let a=0;for(;a<e.length&&(r==null||e[a].seq!=null&&e[a].seq<r);)a++;e.splice(a,0,{seq:r,name:l}),f=a;for(let u of s)u.field>=f&&u.field++}s.push(new I(f,i.length,o.index,o.index+l.length)),c=c.slice(0,o.index)+l+c.slice(o.index+o[0].length)}for(let r;r=/\\([{}])/.exec(c);){c=c.slice(0,r.index)+r[1]+c.slice(r.index+r[0].length);for(let l of s)l.line==i.length&&l.from>r.index&&(l.from--,l.to--)}i.push(c)}return new m(i,s)}},Q=p.widget({widget:new class extends R{toDOM(){let n=document.createElement("span");return n.className="cm-snippetFieldPosition",n}ignoreEvent(){return!1}}}),X=p.mark({class:"cm-snippetField"}),h=class{constructor(t,e){this.ranges=t,this.active=e,this.deco=p.set(t.map(i=>(i.from==i.to?Q:X).range(i.from,i.to)))}map(t){let e=[];for(let i of this.ranges){let s=i.map(t);if(!s)return null;e.push(s)}return new h(e,this.active)}selectionInsideField(t){return t.ranges.every(e=>this.ranges.some(i=>i.field==this.active&&i.from<=e.from&&i.to>=e.to))}},b=y.define({map(n,t){return n&&n.map(t)}}),Y=y.define(),g=T.define({create(){return null},update(n,t){for(let e of t.effects){if(e.is(b))return e.value;if(e.is(Y)&&n)return new h(n.ranges,e.value)}return n&&t.docChanged&&(n=n.map(t.changes)),n&&t.selection&&!n.selectionInsideField(t.selection)&&(n=null),n},provide:n=>x.decorations.from(n,t=>t?t.deco:p.none)});J=({state:n,dispatch:t})=>n.field(g,!1)?(t(n.update({effects:b.of(null)})),!0):!1,Z=j(1),_=j(-1),ee=[{key:"Tab",run:Z,shift:_},{key:"Escape",run:J}],$=E.define({combine(n){return n.length?n[0]:ee}}),te=P.highest(D.compute([$],n=>n.facet($)));ie=x.domEventHandlers({mousedown(n,t){let e=t.state.field(g,!1),i;if(!e||(i=t.posAtCoords({x:n.clientX,y:n.clientY}))==null)return!1;let s=e.ranges.find(o=>o.from<=i&&o.to>=i);return!s||s.field==e.active?!1:(t.dispatch({selection:S(e.ranges,s.field),effects:b.of(e.ranges.some(o=>o.field>s.field)?new h(e.ranges,s.field):null),scrollIntoView:!0}),!0)}}),W=new class extends L{};W.startSide=1;W.endSide=-1;we=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent)});export{B as a,ye as b,xe as c,ve as d,ne as e};
