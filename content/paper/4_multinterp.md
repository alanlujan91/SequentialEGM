
(multinterp)=

# Multivariate Interpolation on Unstructured Grids

This section presents alternative interpolation methods for non-rectilinear grids. First, we present the relatively simple case of fast warped interpolation on a curvilinear grid, which improves upon the interpolation in {cite:t}`White2015`. Then, we present a machine learning approach to interpolation on unstructured grids based on Gaussian Process Regression as presented in {cite:t}`Scheidegger2019`.

## Motivation for Alternative Methods

Unstructured interpolation arises in many dynamic programming applications when using the Endogenous Grid Method because the first-order conditions might be highly non-linear and non-monotonic, or because boundary constraints induce kinks in the policy and value functions. In these cases, the grid points generated by the EGM step are not evenly spaced, leading to the need for curvilinear interpolation. We saw in the previous subsection an approach to curvilinear interpolation based on {cite:t}`White2015` that is suitable for curvilinear but not unstructured grids. A similar approach was presented in {cite:t}`Ludwig2018` which used Delaunay interpolation. However, this approach is not well suited for our purposes because triangulation can be computationally intensive and slow, often offsetting the efficiency gains from the Endogenous Grid Method.

As an alternative to these methods, we introduce the use of Gaussian Process Regression (GPR) along with the Endogenous Grid Method. GPR is computationally efficient, and tools exist to easily parallelize and take advantage of hardware such as Graphics Processing Units (GPU) {cite:p}`Gardner2018`.

## Gaussian Process Regression

A Gaussian Process (GP) is a collection of random variables, any finite subset of which has a joint Gaussian distribution. Formally, a GP is completely specified by its mean function $m(\mathbf{x})$ and covariance (kernel) function $k(\mathbf{x}, \mathbf{x}')$. For any finite set of points, we have

\begin{equation}
    \begin{gathered}
        \mathbf{X} \sim \mathcal{N}(\mathbf{\mu}, \mathbf{\Sigma}) \quad \text{s.t.} \quad x_i \sim \mathcal{N}(\mu_i, \sigma_{ii}) \\
        \text{and} \quad \sigma_{ij} = \Ex[(x_i - \mu_i)(x_j - \mu_j)] \quad \forall i,j \in \{1, \ldots, n\}.
    \end{gathered}
\end{equation}

where

\begin{equation}
    \mathbf{X} = \begin{bmatrix}
        x_1    \\
        x_2    \\
        \vdots \\
        x_n
    \end{bmatrix}
    \quad
    \mathbf{\mu} = \begin{bmatrix}
        \mu_1  \\
        \mu_2  \\
        \vdots \\
        \mu_n
    \end{bmatrix}
    \quad
    \mathbf{\Sigma} = \begin{bmatrix}
        \sigma_{11} & \sigma_{12} & \cdots & \sigma_{1n} \\
        \sigma_{21} & \sigma_{22} & \cdots & \sigma_{2n} \\
        \vdots      & \vdots      & \ddots & \vdots      \\
        \sigma_{n1} & \sigma_{n2} & \cdots & \sigma_{nn}
    \end{bmatrix}.
\end{equation}

A Gaussian Process can be used to represent a probability distribution over the space of functions in $n$ dimensions. Thus, Gaussian Process Regression (GPR) finds the posterior distribution over functions given observed data points. The posterior distribution is

\begin{equation}
    \mathbb{P}(\mathbf{f} | \mathbf{X}) = \mathcal{N}(\mathbf{f} | \mathbf{m}, \mathbf{K})
\end{equation}

where $\mathbf{f}$ is the vector of function values at the points $\mathbf{X}$, $\mathbf{m}$ is the posterior mean vector, and $\mathbf{K}$ is the covariance matrix determined by the kernel function $k(\cdot, \cdot)$ that describes the covariance between function values at different points.

A standard kernel function is the squared exponential (or radial basis function) kernel, which is defined as

\begin{equation}
    k(\mathbf{x}_i, \mathbf{x}_j) = \sigma^2_f \exp\left(-\frac{1}{2l^2} (\mathbf{x}_i - \mathbf{x}_j)' (\mathbf{x}_i -
    \mathbf{x}_j)\right)
\end{equation}

where $\sigma_f^2$ is the signal variance and $l$ is the length-scale parameter. This kernel is infinitely differentiable and assumes smooth functions. Using GPR to interpolate a function $f$, we can both predict the value of the function at a point $\mathbf{x}_*$ and quantify the uncertainty in the prediction via the posterior variance, which provides useful information about approximation accuracy.

## Application to EGM

In [Figure %s](#fig:true_function), we see the function we are trying to approximate along with a sample of data points for which we know the value of the function. In practice, the value of the function is unknown and/or expensive to compute, so we must use a limited amount of data to approximate it.

```{figure} ../../docs/figures/GPR_True_Function.*
:name: fig:true_function
:align: center

The true function that we are trying to approximate and a sample of data points.
```

As we discussed, a Gaussian Process is an infinite dimensional random process which can be used to represent a probability of distributions over the space of functions. In [Figure %s](#fig:gpr_sample), we see a random sample of functions from the GPR posterior, which is a Gaussian Process conditioned on fitting the data. From this small sample of functions, we can see that the GP generates functions that fit the data well, and the goal of GPR is to find the one function that best fits the data given some hyperparameters by minimizing the negative log-likelihood of the data.

```{figure} ../../docs/figures/GPR_Posterior_Sample.*
:name: fig:gpr_sample
:align: center

A random sample of functions from the GPR posterior that fit the data. The goal of GPR is to find the function that best fits the data.
```

In [Figure %s](#fig:gpr), we see the result of GPR with a particular parametrization[^gpr-kernel] of the kernel function. The dotted line shows the true function, while the blue dots show the known data points. GPR provides the mean function which best fits the data, represented in the figure as an orange line. The shaded region represents a 95\% confidence interval, which is the uncertainty of the predicted function. Along with finding the best fit of the function, GPR provides the uncertainty of the prediction, which is useful information as to the accuracy of the approximation.

[^gpr-kernel]: For details see notebook.

```{figure} ../../docs/figures/GaussianProcessRegression.*
:name: fig:gpr
:align: center

GPR finds the function that best fits the data given some hyperparameters. GPR then optimizes over the parameter space to find the function that minimizes the negative log-likelihood of the data.
```
